# Worker Per-Piece Tracking System (Flask + ESP32)

This package includes a **production-ready Flask server** and a **matching ESP32 example**.  
**UI fidelity:** the web UI uses your provided HTML/CSS/JS verbatim so it matches pixel-for-pixel.

## Quickstart (local)
```bash
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
python -m app.wsgi
# open http://127.0.0.1:5000
```

## API (scanner-facing)
- `POST /api/scan` — body: `{"token_id":"ABC123","scanner_id":"S1"}`  
  Toggles login state (login if OUT, logout if IN), enforces forced logout on same scanner.
- `GET /api/worker/<token_id>` — returns worker profile + current bundle state.
- `POST /api/admin/assign` — `{"token_id":"...","bundle_id":1}` — assigns a bundle to a worker.
- `POST /api/admin/upload_operations` — upload CSV/XLSX with columns `operation_name,rate_per_piece`.
- `POST /api/admin/upload_po?total=1119` — upload a PO file (PDF/CSV/XLSX accepted). Creates 12 bundles by distribution.

## Admin UI
Served at `/` and matches your static UI. To wire the uploads and actions to live endpoints, swap mock calls in `app/static/js/app.js` for `fetch()` requests (kept intact for fidelity).

## Database
- SQLite file at `attendance.db` (generated by `scripts/init_db.py`).
- Schema in `app/models.py`.

## Tests
```bash
pytest -q
```

## Render Deployment
Use `render.yaml` or:
```bash
pip install -r requirements.txt
gunicorn app.wsgi:app --workers=2 --preload --timeout 120
```

## ESP32
See `esp32_example/WorkerScanner.ino` for Arduino-based firmware posting to `/api/scan`. Includes TFT layout + wiring.
