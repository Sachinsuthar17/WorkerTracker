{% extends "layout.html" %}
{% set title = "Settings" %}
{% block content %}

<div class="page-header">
  <h1>System Settings</h1>
  <p>Environment + Appearance</p>
</div>

<div class="grid-2">
  <section class="card">
    <h2>Environment (from Render)</h2>
    <ul style="margin:8px 0 0; padding:0 0 0 18px; color:var(--text-secondary)">
      <li><strong>DEVICE_SECRET</strong> – used by ESP32 to authenticate.</li>
      <li><strong>RATE_PER_PIECE</strong> – default <span class="badge">₹{{ "%.2f"|format(rate_per_piece) }}</span></li>
    </ul>
    <p style="margin-top:12px; color:var(--text-muted)">Change these in Render → Environment → Redeploy.</p>
  </section>

  <section class="card">
    <h2>Theme Customisation</h2>
    <div class="row" style="margin:12px 0">
      <label>Accent Colour</label>
      <input type="color" id="accentColor" class="ui-input" style="width:120px; padding:4px">
      <button type="button" id="resetColor" class="btn btn-secondary">Reset</button>
    </div>
    <p style="color:var(--text-muted)">Your choice is saved in this browser and applied across all pages.</p>
  </section>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function(){
    const picker = document.getElementById('accentColor');
    const reset  = document.getElementById('resetColor');
    const el     = document.documentElement;

    // compute darker shade for hover
    const darken = (hex, f=0.7) => '#'+hex.replace('#','')
      .match(/.{1,2}/g).map(h=>('0'+Math.max(0,Math.min(255,Math.floor(parseInt(h,16)*f))).toString(16)).slice(-2)).join('');

    // load existing
    const saved = localStorage.getItem('accentColor');
    picker.value = saved || getComputedStyle(el).getPropertyValue('--accent-color').trim() || '#3b82f6';

    const apply = (c) => {
      el.style.setProperty('--accent-color', c);
      el.style.setProperty('--accent-color-dark', darken(c, 0.7));
    };

    picker.addEventListener('change', () => {
      localStorage.setItem('accentColor', picker.value);
      apply(picker.value);
    });
    reset.addEventListener('click', () => {
      localStorage.removeItem('accentColor');
      picker.value = '#3b82f6';
      apply('#3b82f6');
    });
  });
</script>
{% endblock %}
