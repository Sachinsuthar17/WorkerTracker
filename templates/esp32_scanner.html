{% extends "layout.html" %}

{% block title %}ESP32 Scanner Demo - PMS{% endblock %}
{% block page_title %}ESP32 Scanner Demo{% endblock %}

{% block content %}
<div class="scanner-layout">
    <!-- Scanner Interface -->
    <div class="scanner-section">
        <div class="section-header">Scanner Interface</div>
        <div class="scanner-interface">
            <div class="scan-area" id="scanArea">
                Ready to scan...
            </div>
            <div class="scan-controls">
                <button class="btn btn-primary" onclick="simulateScan()">
                    <i class="fas fa-qrcode"></i> Simulate Scan
                </button>
                <button class="btn btn-secondary" onclick="resetScanner()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
        </div>
    </div>

    <!-- Scan Log -->
    <div class="scan-log">
        <div class="section-header">Scan Log</div>
        <div class="scan-log-body" id="scanLogBody">
            <div class="log-item">
                <div class="worker-info">
                    <div class="worker-name">Rajesh Kumar (RK001)</div>
                    <div class="worker-time">14:26:52</div>
                </div>
                <div class="status-badge status-login">LOGIN</div>
            </div>
            <div class="log-item">
                <div class="worker-info">
                    <div class="worker-name">Priya Sharma (PS002)</div>
                    <div class="worker-time">14:18:45</div>
                </div>
                <div class="status-badge status-logout">LOGOUT</div>
            </div>
            <div class="log-item">
                <div class="worker-info">
                    <div class="worker-name">Amit Singh (AS003)</div>
                    <div class="worker-time">14:14:02</div>
                </div>
                <div class="status-badge status-login">LOGIN</div>
            </div>
            <div class="log-item">
                <div class="worker-info">
                    <div class="worker-name">Sunita Devi (SD004)</div>
                    <div class="worker-time">14:09:26</div>
                </div>
                <div class="status-badge status-logout">LOGOUT</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function simulateScan() {
    const scanArea = document.getElementById('scanArea');
    const workers = [
        {name: 'Vikram Yadav (VY005)', action: 'LOGIN'},
        {name: 'Kavita Patel (KP006)', action: 'LOGOUT'},
        {name: 'Ravi Gupta (RG007)', action: 'LOGIN'}
    ];

    const worker = workers[Math.floor(Math.random() * workers.length)];
    const now = new Date().toLocaleTimeString();

    scanArea.textContent = `Scanning ${worker.name}...`;

    setTimeout(() => {
        scanArea.textContent = 'Ready to scan...';
        addLogEntry(worker.name, worker.action, now);
    }, 1500);
}

function addLogEntry(workerName, action, time) {
    const logBody = document.getElementById('scanLogBody');
    const logItem = document.createElement('div');
    logItem.className = 'log-item';

    logItem.innerHTML = `
        <div class="worker-info">
            <div class="worker-name">${workerName}</div>
            <div class="worker-time">${time}</div>
        </div>
        <div class="status-badge status-${action.toLowerCase()}">${action}</div>
    `;

    logBody.insertBefore(logItem, logBody.firstChild);

    // Keep only last 10 entries
    while (logBody.children.length > 10) {
        logBody.removeChild(logBody.lastChild);
    }
}

function resetScanner() {
    document.getElementById('scanArea').textContent = 'Ready to scan...';
}
</script>
{% endblock %}