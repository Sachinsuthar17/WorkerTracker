{% extends "base.html" %}
{% block content %}
<h1>Workers</h1>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<form method="post" class="form-inline mb-3">
  <input class="form-control me-2" name="worker_code" placeholder="Worker Code (e.g. W001)" required>
  <input class="form-control me-2" name="name" placeholder="Name" required>
  <input class="form-control me-2" name="department" placeholder="Department">
  <input class="form-control me-2" name="skill" placeholder="Skill">
  <input class="form-control me-2" name="hourly_rate" type="number" step="0.01" placeholder="Hourly Rate">
  <button class="btn btn-primary" type="submit">Add Worker</button>
</form>

<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>ID</th><th>Code</th><th>Name</th><th>Dept</th>
      <th>Skill</th><th>Rate</th><th>QR</th><th></th>
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td>{{ u.id }}</td>
      <td>{{ u.worker_code }}</td>
      <td>{{ u.name }}</td>
      <td>{{ u.department or '' }}</td>
      <td>{{ u.skill or '' }}</td>
      <td>{{ u.hourly_rate }}</td>
      <td><img src="{{ url_for('worker_qr', uid=u.id) }}" width="80"></td>
      <td>
        <form action="{{ url_for('users_delete', uid=u.id) }}" method="post" onsubmit="return confirm('Delete?')">
          <button class="btn btn-sm btn-danger">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
