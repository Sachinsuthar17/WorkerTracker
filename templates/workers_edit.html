{% extends "layout.html" %}
{% set title = "Edit Worker" %}

{% block content %}
<section class="max-w-3xl mx-auto grid gap-4">
  <header>
    <h1 class="text-xl font-semibold">Edit Worker</h1>
    <p class="text-sm text-slate-500">Update details or token. Leave token blank to remove it.</p>
  </header>

  <div class="bg-white rounded-2xl p-5 shadow-card border border-slate-100">
    <form class="grid md:grid-cols-2 gap-4" method="post" action="{{ url_for('workers_edit', worker_id=worker.id) }}">
      <div>
        <label class="block text-xs font-medium text-slate-600 mb-1">Name</label>
        <input name="name" type="text" value="{{ worker.name }}"
               class="w-full rounded-xl border-slate-200 focus:ring-2 focus:ring-sky-300 focus:border-sky-300" />
      </div>
      <div>
        <label class="block text-xs font-medium text-slate-600 mb-1">Department / Line</label>
        <input name="department" type="text" value="{{ worker.department }}"
               class="w-full rounded-xl border-slate-200 focus:ring-2 focus:ring-sky-300 focus:border-sky-300" />
      </div>
      <div class="md:col-span-2">
        <label class="block text-xs font-medium text-slate-600 mb-1">Token (manual)</label>
        <input name="token" type="text" value="{{ worker.token_id }}"
               class="w-full rounded-xl border-slate-200 focus:ring-2 focus:ring-sky-300 focus:border-sky-300" />
        <p class="text-[11px] text-slate-500 mt-1">Don’t include <code>W:</code> prefix. Must be unique if set.</p>
      </div>

      <div class="md:col-span-2 flex gap-3">
        <button type="submit"
                class="inline-flex items-center gap-2 rounded-xl px-4 h-10 bg-sky-600 text-white font-medium hover:bg-sky-700">
          Save Changes
        </button>
        <a href="{{ url_for('workers_page') }}"
           class="inline-flex items-center gap-2 rounded-xl px-4 h-10 bg-slate-200 text-slate-700 font-medium hover:bg-slate-300">
          Cancel
        </a>
        {% if worker.token_id %}
        <a href="{{ url_for('workers_print', worker_id=worker.id) }}" target="_blank"
           class="inline-flex items-center gap-2 rounded-xl px-4 h-10 bg-slate-800 text-white font-medium hover:bg-slate-900">
          Print QR
        </a>
        {% endif %}
      </div>
    </form>
  </div>

  {% if worker.token_id %}
  <div class="bg-white rounded-2xl p-5 shadow-card border border-slate-100">
    <h2 class="text-sm font-semibold mb-3">Current QR Preview</h2>
    <div class="flex items-start gap-6">
      <img class="w-40 h-40 border border-slate-200 rounded-xl" src="{{ url_for('worker_qr_png', worker_id=worker.id) }}" alt="QR">
      <div class="text-sm">
        <div><span class="text-slate-500">Name:</span> <strong>{{ worker.name or "(no name)" }}</strong></div>
        <div><span class="text-slate-500">Department:</span> <strong>{{ worker.department or "—" }}</strong></div>
        <div><span class="text-slate-500">Token:</span> <code>{{ worker.token_id }}</code></div>
        <div class="mt-3 flex gap-2">
          <a class="inline-flex items-center gap-2 rounded-lg px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium hover:bg-emerald-700"
             href="{{ url_for('worker_qr_png', worker_id=worker.id) }}" target="_blank">PNG</a>
          <a class="inline-flex items-center gap-2 rounded-lg px-3 py-1.5 bg-indigo-600 text-white text-xs font-medium hover:bg-indigo-700"
             href="{{ url_for('worker_qr_svg', worker_id=worker.id) }}" target="_blank">SVG</a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</section>
{% endblock %}
