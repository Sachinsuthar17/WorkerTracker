{% extends "base.html" %}
{% block content %}
<h1>Production Dashboard</h1>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<div class="cards mb-4">
  <div class="card">
    <div class="card-title">Active Workers</div>
    <div class="card-value">{{ total_workers }}</div>
  </div>
  <div class="card">
    <div class="card-title">Bundles</div>
    <div class="card-value">{{ bundles_active }}</div>
  </div>
  <div class="card">
    <div class="card-title">Pieces Today</div>
    <div class="card-value">{{ scans_today }}</div>
  </div>
  <div class="card">
    <div class="card-title">Earnings Today</div>
    <div class="card-value">${{ "{:,.2f}".format(earnings_today) }}</div>
  </div>
</div>

<div class="grid-2">
  <section>
    <h2>Recent Activity</h2>
    <table class="table table-striped table-sm" id="recent-table">
      <thead>
        <tr><th>Time</th><th>Worker</th><th>Bundle</th><th>Op</th><th>Std Min</th></tr>
      </thead>
      <tbody>
        {% for r in recent %}
        <tr>
          <td>{{ r.timestamp.strftime("%Y-%m-%d %H:%M") if r.timestamp }}</td>
          <td>{{ r.worker }}</td>
          <td>{{ r.bundle }}</td>
          <td>{{ r.op_no }}</td>
          <td>{{ '%.2f' % r.std_min }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section>
    <h2>Worker Leaderboard (Today)</h2>
    <table class="table table-bordered table-striped table-sm">
      <thead><tr><th>Worker</th><th>Pieces</th><th>Std Min</th></tr></thead>
      <tbody>
        {% for r in leaderboard %}
        <tr>
          <td>{{ r.name }}</td>
          <td>{{ r.pieces }}</td>
          <td>{{ '%.2f' % r.std_min }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>
{% endblock %}
