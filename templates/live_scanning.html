{% extends "layout.html" %}
{% set title = "Live Scanning" %}
{% block content %}

<div class="page-header">
  <h1>Live Scanning Dashboard</h1>
  <p>Recent activity and worker status</p>
</div>

<section class="stats-grid">
  <div class="stats-tile"><div class="title">Active Scans</div><div class="value">{{ live.active_scans|default(0) }}</div></div>
  <div class="stats-tile"><div class="title">Avg Time</div><div class="value">{{ live.avg_time|default('2.5 hrs') }}</div></div>
  <div class="stats-tile"><div class="title">Efficiency</div><div class="value">{{ live.efficiency|default('104%') }}</div></div>
  <div class="stats-tile"><div class="title">Auto-refresh</div><div class="value">10s</div></div>
</section>

<div class="grid-2" style="margin-top:14px">
  <section class="card">
    <h2>Recent Scanning Activity</h2>
    <div class="table-container" style="margin-top:8px">
      <table class="ui-table">
        <thead><tr><th>Bundle</th><th>Worker</th><th>Operation</th><th>Time</th></tr></thead>
        <tbody>
          {% for r in recent or [] %}
          <tr>
            <td>{{ r.bundle }}</td>
            <td>{{ r.worker }}</td>
            <td>{{ r.operation }}</td>
            <td>{{ r.time }}</td>
          </tr>
          {% else %}
          <tr><td colspan="4" style="text-align:center; color:var(--text-secondary)">No activity yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <h2>Worker Activity (Last 2 Hours)</h2>
    <div class="table-container" style="margin-top:8px">
      <table class="ui-table">
        <thead><tr><th>Worker</th><th>Dept</th><th>Status</th></tr></thead>
        <tbody>
          {% for w in workers or [] %}
          <tr>
            <td>{{ w.name }}</td>
            <td>{{ w.department }}</td>
            <td>{{ w.status|default('No activity') }}</td>
          </tr>
          {% else %}
          <tr><td colspan="3" style="text-align:center; color:var(--text-secondary)">No data.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>

<section class="card" style="margin-top:14px">
  <h2>API Endpoint</h2>
  <div style="margin-top:8px">
    <span class="badge">POST /api/scan</span>
    <div style="margin-top:6px; color:var(--text-secondary)">Device Secret: <code style="color:#fff">{{ device_secret|default('garment_erp_2024_secret') }}</code></div>
  </div>
</section>
{% endblock %}
