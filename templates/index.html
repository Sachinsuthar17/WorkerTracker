{% extends 'layout.html' %}
{% set spa = true %}
{% block title %}Production Management System{% endblock %}

{% block content %}
  <!-- Dashboard Section -->
  <section class="section active" id="dashboard">
    <!-- your dashboard cards/charts/feeds go here -->
    <div class="section-header">
      <h1>Dashboard</h1>
      <div class="header-actions">
        <button id="refreshBtn" class="btn btn--secondary">Refresh</button>
        <span id="lastUpdated" class="last-updated"></span>
      </div>
    </div>

    <div class="kpi-grid">
      <div class="kpi-card"><div class="kpi-icon">üë•</div><div class="kpi-content">
        <div id="activeWorkers" class="kpi-value">0</div><div class="kpi-label">Active Workers</div></div></div>
      <div class="kpi-card"><div class="kpi-icon">üì¶</div><div class="kpi-content">
        <div id="totalBundles" class="kpi-value">0</div><div class="kpi-label">Total Bundles</div></div></div>
      <div class="kpi-card"><div class="kpi-icon">‚öôÔ∏è</div><div class="kpi-content">
        <div id="totalOperations" class="kpi-value">0</div><div class="kpi-label">Operations</div></div></div>
      <div class="kpi-card"><div class="kpi-icon">‚Çπ</div><div class="kpi-content">
        <div id="totalEarnings" class="kpi-value">0.00</div><div class="kpi-label">Earnings (demo)</div></div></div>
    </div>

    <div class="charts-grid">
      <div class="chart-card">
        <h3>Bundle Status</h3>
        <div class="chart-container"><canvas id="bundleStatusChart"></canvas></div>
      </div>
      <div class="chart-card">
        <h3>Department Workload</h3>
        <div class="chart-container"><canvas id="departmentChart"></canvas></div>
      </div>
    </div>

    <div class="activity-card">
      <h3>Recent Activity</h3>
      <div id="activityFeed" class="activity-feed"></div>
    </div>
  </section>

  <!-- Worker Management Section -->
  <section class="section" id="workers">
    <div class="section-header">
      <h1>Worker Management</h1>
      <div class="header-controls">
        <input type="text" class="form-control search-input" id="workerSearch" placeholder="Search workers...">
        <select class="form-control" id="departmentFilter">
          <option value="">All Departments</option>
          <option value="Cutting">Cutting</option>
          <option value="Sewing">Sewing</option>
          <option value="Finishing">Finishing</option>
          <option value="Quality">Quality</option>
          <option value="Packing">Packing</option>
        </select>
        <select class="form-control" id="statusFilter">
          <option value="">All Status</option>
          <option value="Active">Active</option>
          <option value="Idle">Idle</option>
        </select>

        <a href="{{ url_for('add_worker') }}" class="btn btn--primary btn-sm">+ Add Worker</a>
        <form action="{{ url_for('upload_workers') }}" method="post" enctype="multipart/form-data" style="display:inline;">
          <input type="file" name="file" accept=".xlsx" required class="form-control btn-sm" style="display:inline-block;">
          <button type="submit" class="btn btn--outline btn-sm">Bulk Upload Excel</button>
        </form>
      </div>
    </div>

    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th><th>Token ID</th><th>Department</th><th>Line</th><th>Status</th><th>QR Code</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="workersTable">
          {% for worker in workers %}
            <tr>
              <td>{{ worker.name }}</td>
              <td>{{ worker.token_id }}</td>
              <td>{{ worker.department }}</td>
              <td>{{ worker.line or 'N/A' }}</td>
              <td>
                {% if worker.active %}
                  <span class="status-badge status-active">ACTIVE</span>
                {% else %}
                  <span class="status-badge status-idle">INACTIVE</span>
                {% endif %}
              </td>
              <td>
                {% if worker.qrcode_path %}
                  <img src="{{ url_for('static', filename=worker.qrcode_path) }}" width="40" alt="QR">
                {% else %}No QR{% endif %}
              </td>
              <td>
                <a href="{{ url_for('edit_worker', worker_id=worker.id) }}" class="btn btn--primary btn-sm">Edit</a>
                <a href="{{ url_for('delete_worker', worker_id=worker.id) }}" class="btn btn--secondary btn-sm"
                   onclick="return confirm('Are you sure you want to delete this worker?');">Delete</a>
                {% if worker.qrcode_path %}
                  <a href="{{ url_for('download_qr', worker_id=worker.id) }}" class="btn btn--outline btn-sm">Download QR</a>
                {% endif %}
              </td>
            </tr>
          {% else %}
            <tr><td colspan="7" class="loading">No workers found</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Add your other sections with the same markup IDs: operations, bundles, production-order, file-upload, scanner, reports -->
{% endblock %}
